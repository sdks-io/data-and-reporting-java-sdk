/*
 * ShellDataReportingAPIsLib
 *
 * This file was automatically generated by APIMATIC v3.0 ( https://www.apimatic.io ).
 */

package com.shell.apitest.controllers;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertTrue;

import com.shell.apitest.ApiHelper;
import com.shell.apitest.ShellDataReportingAPIsClient;
import com.shell.apitest.exceptions.ApiException;
import com.shell.apitest.models.PricedTransactionRequestV2;
import com.shell.apitest.models.PricedTransactionResponseV2;
import com.shell.apitest.models.RecentTransactionRequest;
import com.shell.apitest.models.RecentTransactionsResponse;
import io.apimatic.core.utilities.TestHelper;
import java.util.LinkedHashMap;
import java.util.Map;
import org.junit.AfterClass;
import org.junit.BeforeClass;
import org.junit.Test;

public class TransactionControllerTest extends BaseControllerTest {

    /**
     * Client instance.
     */
    private static ShellDataReportingAPIsClient client;
    
    /**
     * Controller instance (for all tests).
     */
    private static TransactionController controller;

    /**
     * Setup test class.
     */
    @BeforeClass
    public static void setUpClass() {
        client = createConfiguration();
        controller = client.getTransactionController();
    }

    /**
     * Tear down test class.
     */
    @AfterClass
    public static void tearDownClass() {
        controller = null;
    }

    /**
     * This endpoint allows querying last 48 hours of transaction data of Shell Card (i.e. Priced,
     * Billed, Unbilled etc. sales items). It provides a flexible search criteria and supports
     * pagination. E.g., if the request is made at 08:30 AM on 18 Aug 2022 then transactions until
     * 16 Aug 2022 08:30 AM (including) can be retrieved. #### Supported operations * Search by Date
     * and Time range (within the last 48 hours only) * Search by Payer and/or Account number *
     * Search by Card * Search by Purchased Country * Search by Transaction posting date * Search by
     * Driver Name or Vehicle registration number * Search by Fuel only transactions * Search by
     * Product and/or Product group.
     * @throws Throwable exception if occurs.
     */
    @Test
    public void testTestRecentTransactionsNew() throws Exception {
        // Parameters for the API call
        String requestId = 
                "2b0cbe11-f109-4c43-9201-49af0370df1c";
        RecentTransactionRequest body = ApiHelper.deserialize(
                "{\"PageSize\":1,\"Page\":1,\"Filters\":{\"ColCoCode\":14,\"PayerNumber\":\"GB00001"
                + "232\",\"AccountNumber\":\"GB00001233\",\"ProductCode\":\"22\",\"PurchasedInCount"
                + "ry\":\"GB\",\"CardPAN\":\"700205******890645\",\"FromDateTime\":\"2020-11-09 13:"
                + "56:03.000\",\"ToDateTime\":\"2020-12-09 13:56:03.000\",\"TransactionStatus\":\"A"
                + "PPROVED\",\"FuelOnly\":\"False\",\"ProductGroupName\":\"Motor gasoline\",\"Vehic"
                + "leRegistrationNumber\":\"YG67OUM\",\"IncludeDeclines\":true,\"CardIssuerName\":"
                + "\"Mathew\",\"ColumnList\":\"PayerNumber,AccountNumber,ProductName,FuelVolume,PAN"
                + "\"}}",
                RecentTransactionRequest.class);

        // Set callback and perform API call
        RecentTransactionsResponse result = null;
        try {
            result = controller.recentTransactionsNew(requestId, body);
        } catch (ApiException e) {
            // Empty block
        }

        // Test whether the response is null
        assertNotNull("Response is null", 
                httpResponse.getResponse());
        // Test response code
        assertEquals("Status is not 200", 
                200, httpResponse.getResponse().getStatusCode());

        // Test headers
        Map<String, String> headers = new LinkedHashMap<String, String>();
        headers.put("Content-Type", "application/json");
        
        assertTrue("Headers do not match", TestHelper.areHeadersProperSubsetOf(
                headers, httpResponse.getResponse().getHeaders().asSimpleMap(), true));

        // Test whether the captured response is as we expected
        assertNotNull("Result does not exist", 
                result);
        assertTrue("Response body does not match in keys", 
                TestHelper.isJsonObjectProperSubsetOf(
                "{\"RequestId\":\"9d2dee33-7803-485a-a2b1-2c7538e597ee\",\"Status\":\"SUCCESS\",\"P"
                + "age\":1,\"RowCount\":2,\"TotalPages\":1,\"Data\":[{\"ColCoCode\":84,\"PayerNumbe"
                + "r\":\"MY00200653\",\"AccountNumber\":\"MY00200653\",\"CardIssueNumber\":\"1\","
                + "\"CollectingCompanyCurrencyCode\":\"MYR\",\"CustDataCustomerEntered\":\"PartnerI"
                + "d\",\"CustDataDriverId\":\"D123\",\"CustDataFleetDescription\":\"Fleet-Truck\","
                + "\"FleetIdInput\":\"AS2344\",\"Amount\":62.47,\"EuroshellSiteNumber\":\"1231\","
                + "\"IncomingProductCode\":\"10\",\"ProductCode\":\"23\",\"ProductName\":\"Unleaded"
                + " - Low octane\",\"SiteCode\":3350,\"HostingCollectingCompanyName\":\"Shell Malay"
                + "sia Trading Sdn Bhd\",\"HostingCollectingCompanyNumber\":\"84\",\"IccdataTranTyp"
                + "eCode\":\"1\",\"TransactionType\":\"Transaction Type description\",\"Latitude\":"
                + "\"52.143814\",\"Longitude\":\"101.72869\",\"MerchantCategory\":\"5542\",\"Mercha"
                + "ntCategoryDescription\":\"Description\",\"PurchasedInCountry\":\"MY\",\"Merchant"
                + "Id\":\"MY1737000000000\",\"SiteName\":\"ShellPT3895 BATU 4    KUALA LUMPUR MY\","
                + "\"Network\":\"458\",\"DelcoCode\":\"084\",\"OdometerInput\":\"201620\",\"Odomete"
                + "rReadingKm\":\"201620\",\"OdometerReadingMiles\":\"201620\",\"CardPAN\":\"700214"
                + "*******780061\",\"PINIndicator\":\"Y\",\"POIReceiptNumber\":\"417662\",\"Product"
                + "sCodeAdditional\":\"Additional Code\",\"ProductsTaxCode\":\"0\",\"FuelVolume\":3"
                + "4.15,\"SfgwCardDateOfExpiry\":\"2024-12\",\"SiteCurrencyISOCode\":\"MYR\",\"Card"
                + "Id\":\"330743\",\"TransactionDate\":\"2021-11-11\",\"TransactionDateTime\":\"202"
                + "1-11-11 16:32:09.000\",\"TransactionId\":\"864220307\",\"TransactionStatus\":\"A"
                + "pproved\",\"UnitOfMeasure\":\"L\",\"VehicleRegistrationNumber\":\"WD33637\",\"Ne"
                + "tworkDelcoName\":\"Shell Malaysia Trading Sdn Bhd\",\"ProductGroupName\":\"Motor"
                + " gasoline\",\"FuelProduct\":\"All Fuels\",\"AccountCustomerName\":\"WCT BERHAD"
                + "\",\"PayerName\":\"WCT BERHAD\",\"TransactionTime\":\"2021-11-11\",\"Transaction"
                + "Currency\":\"RM\",\"UnitPrice\":0.02050073206442167,\"AuthorisedFlag\":\"Y\",\"T"
                + "ransactionTimeGMT\":\"08:41:02\",\"ReasonCode\":\"10\",\"IssuerActionCode\":\"2"
                + "\",\"IssuerActionCodeDescription\":\"Approved, partial\",\"DeclinedReason\":\"pa"
                + "rtial\",\"CardStatusReasonDescription\":\"Approved, partial\",\"TransactionCount"
                + "ry\":\"458\",\"IssuingCollectingCompanyName\":\"Partner Name\",\"CardIssuerName"
                + "\":\"John\",\"DriverName\":\"PAK PAK\",\"BearerDescription\":\"Description\",\"C"
                + "ardCategoryDescription\":\"Driver Card\",\"CardTypeDescription\":\"SHELL FLEET- "
                + "HONG KONG 7002821\",\"CardTokenTypeDescription\":\"HK FLE NAT SIN R1 - CHIP\","
                + "\"EmbossType\":\"Driver\",\"EVPrintedNumber\":\"NL-TNM-C00122045-K\",\"IsRFID\":"
                + "false}]}",
                TestHelper.convertStreamToString(httpResponse.getResponse().getRawBody()), 
                false, true, false));
    }

    /**
     * This API allows querying transaction data (i.e. Priced, Billed and Unbilled sales items). It
     * provides a flexible search criteria and supports paging. The version 2 is an enhancement to
     * the version 1 where EV transactions and their details are added in the response. Transactions
     * that are posted but not yet priced, billed or that are in error will not be returned by this
     * API. The API also supports returning Fee Items. #### Supported operations * Get sales items
     * and fee transactions * Search by invoice status * Search by fixed date period * Search by
     * date range * Search by account * Search by card * Get sales items only * Search by
     * transaction Id or location * Search by transaction posting date * Search by invoice number or
     * date * Search by driver name or vehicle registration number * Search by card group * Search
     * by fuel only transactions * Search by product * EV transaction details - Below are EV
     * specific parameters * EVOperator * EVSerialId * EVChargePointSerial *
     * EVChargePointConnectorType * EVChargePointConnectorTypeDescription * EVChargeDuration *
     * EVChargeStartDate * EVChargeStartTime * EVChargeEndDate * EVChargeEndTime .
     * @throws Throwable exception if occurs.
     */
    @Test
    public void testTestPricedTransactionsV2() throws Exception {
        // Parameters for the API call
        String requestId = 
                "2b0cbe11-f109-4c43-9201-49af0370df1c";
        PricedTransactionRequestV2 body = ApiHelper.deserialize(
                "{\"PageSize\":1,\"Page\":1,\"Filters\":{\"ColCoCode\":\"032\",\"InvoiceStatus\":"
                + "\"A\",\"PayerNumber\":\"DE26685263\",\"AccountId\":29484,\"AccountNumber\":\"DE2"
                + "6667080\",\"DriverName\":\"HH NX 508\",\"CardGroupId\":40000,\"CardPAN\":\"70020"
                + "51006629890645\",\"ProductCode\":\"10\",\"ProductName\":\"Diesel AGO\",\"SiteCod"
                + "e\":\"05000100\",\"IncomingSiteNumber\":\"100021\",\"InvoiceDate\":\"2021-01-01"
                + "\",\"InvoiceNumber\":\"3201016193\",\"PurchasedInCountryCode\":\"GB\",\"Purchase"
                + "dInCountry\":\"United Kingdom\",\"SiteGroupId\":202,\"VehicleRegistrationNumber"
                + "\":\"4K46801\",\"FeeTypeId\":275549,\"LineItemDescription\":\"ABC3\",\"Cards\":["
                + "0],\"SortOrder\":\"5\",\"FromDate\":\"2022-01-01 00:00:00\",\"ToDate\":\"2022-01"
                + "-01 00:00:00\",\"Period\":3,\"PostingDateFrom\":\"2022-01-01 00:00:00\",\"Postin"
                + "gDateTo\":\"2022-01-01 00:00:00\",\"TransactionItemId\":\"1208176398\",\"FuelOnl"
                + "y\":false,\"IncludeFees\":true,\"IsMultipayer\":true,\"ValidInvoiceDateOnly\":fa"
                + "lse,\"InvoiceFromDate\":\"2022-01-01 00:00:00\",\"InvoiceToDate\":\"2022-01-01 0"
                + "0:00:00\",\"HostingCollectingCompanyNumber\":\"032\",\"Search\":\"2K89909\",\"Tr"
                + "ansactionId\":\"io9KVXk1UkW57XWKyeaHHg\"}}",
                PricedTransactionRequestV2.class);

        // Set callback and perform API call
        PricedTransactionResponseV2 result = null;
        try {
            result = controller.pricedTransactionsV2(requestId, body);
        } catch (ApiException e) {
            // Empty block
        }

        // Test whether the response is null
        assertNotNull("Response is null", 
                httpResponse.getResponse());
        // Test response code
        assertEquals("Status is not 200", 
                200, httpResponse.getResponse().getStatusCode());

        // Test headers
        Map<String, String> headers = new LinkedHashMap<String, String>();
        headers.put("Content-Type", "application/json");
        
        assertTrue("Headers do not match", TestHelper.areHeadersProperSubsetOf(
                headers, httpResponse.getResponse().getHeaders().asSimpleMap(), true));

        // Test whether the captured response is as we expected
        assertNotNull("Result does not exist", 
                result);
        assertTrue("Response body does not match in keys", 
                TestHelper.isJsonObjectProperSubsetOf(
                "{\"RequestId\":\"9d2dee33-7803-485a-a2b1-2c7538e597ee\",\"Status\":\"SUCCESS\",\"D"
                + "ata\":[{\"AccountName\":\"Blue Colour Ltd\",\"AccountId\":29484,\"AccountNumber"
                + "\":\"DE26667080\",\"AccountShortName\":\"Mathew\",\"Additional1\":\"GBALLEGO0002"
                + "452\",\"Additional2\":\"GBALLEGO0002452\",\"Additional3\":\"GBALLEGO0002452\","
                + "\"Additional4\":\"GBALLEGO0002452\",\"AllowClearing\":\"Null\",\"AuthorisationCo"
                + "de\":300796,\"TransactionStatus\":\"Y\",\"DriverName\":\"SATTY BHAMRA\",\"CardEx"
                + "piryPeriod\":2204,\"CardExpiry\":\"2022-01-01\",\"CardGroupId\":40000,\"CardGrou"
                + "pName\":\"006240 FIRE BRIGHT SOLUTIONS\",\"IssuerCode\":7002,\"CardPAN\":\"70020"
                + "53465789891000\",\"ReleaseCode\":9,\"CardSequenceNumber\":617,\"CardType\":\"GB "
                + "STD FLT NAT SINGLE R9\",\"ColCoCode\":\"014\",\"UnitDiscountInvoiceCurrency\":-0"
                + ".0051,\"ColCoExchangeRate\":0.851858,\"InvoiceCurrencySymbol\":\"GBP\",\"Correct"
                + "ionFlag\":true,\"CRMNumber\":10,\"CustomerCountry\":\"United Kingdom\",\"Custome"
                + "rCurrencyCode\":\"GBP\",\"CustomerCurrencySymbol\":\"Â£\",\"RebateonNetAmountInCu"
                + "stomerCurrency\":0,\"EffectiveDiscountInCustomerCurrency\":-0.22,\"EffectiveUnit"
                + "DiscountInCustomerCurrency\":-0.0051,\"UnitPriceInInvoiceCurrency\":1.1024,\"Inv"
                + "oiceTax\":0,\"InvoiceGrossAmount\":57.25,\"InvoiceNetAmount\":47.71,\"VATonNetAm"
                + "ountInCustomerCurrency\":9.54,\"CustomerRetailPriceUnitGross\":0,\"CustomerRetai"
                + "lValueTotalGross\":57.52,\"CustomerRetailValueTotalNet\":47.93,\"TransactionType"
                + "Description\":9.59,\"RebateonNetAmountInTransactionCurrency\":-0.22,\"EffectiveD"
                + "iscountInTrxCurrency\":-0.22,\"DelCoToColCoExchangeRate\":0,\"Cards\":[275549],"
                + "\"UnitDiscountTransactionCurrency\":-0.005,\"TransactionGrossAmount\":57.25,\"Tr"
                + "ansactionNetAmount\":47.71,\"TransactionTax\":9.54,\"VATonNetAmount\":9.54,\"Del"
                + "coListPriceUnitNet\":0,\"DelcoRetailPriceUnitGross\":1.32888,\"UnitPriceInTransa"
                + "ctionCurrency\":1.1074,\"DelcoRetailPriceUnitNet\":1.1074,\"DelcoRetailValueTota"
                + "lGross\":57.52,\"DelcoRetailValueTotalNet\":47.93,\"TransactionCurrencySymbol\":"
                + "\"$\",\"DiscountType\":\"Retail\",\"DisputeStatus\":false,\"IsShellSite\":false,"
                + "\"FleetIdInput\":\"YG67OUM\",\"IncomingProductCode\":23,\"PostingDate\":\"2021-0"
                + "8-02\",\"PostingTime\":\"0001-01-01T14:15:22Z\",\"ProductCode\":30,\"ProductName"
                + "\":\"Unleaded - Medium octane\",\"ProductGroupId\":22,\"IncomingCurrencyCode\":"
                + "\"GBP\",\"IncomingSiteDescription\":\"Shell Broadway Ring\",\"Location\":\"Shell"
                + " Broadway Ring\",\"SiteName\":\"Shell Broadway Ring\",\"SiteCode\":32,\"Incoming"
                + "SiteNumber\":15,\"InvoiceCurrencyCode\":\"GBP\",\"InvoiceDate\":\"2021-08-02\","
                + "\"InvoiceNumber\":3201016193,\"FuelProduct\":true,\"VATApplicable\":\"Y\",\"Paye"
                + "rName\":\"Colours Services Ltd\",\"PayerNumber\":\"GB12121212\",\"ParentCustomer"
                + "Number\":\"GB12121212\",\"PayerGroup\":\"H312066\",\"PayerGroupName\":\"12162566"
                + " - FUEL CARD SERVICE\",\"CheckDigit\":6,\"NetInvoiceIndicator\":\"Y\",\"DelcoCod"
                + "e\":5,\"NetworkCode\":3,\"PurchasedInCountry\":\"United Kingdom\",\"SiteCountry"
                + "\":\"United Kingdom\",\"VATCountry\":\"United Kingdom\",\"DelcoName\":\"Shell U."
                + "K. Oil Products Limited\",\"Network\":\"Shell\",\"OdometerInput\":0,\"OriginalSa"
                + "lesItemId\":\"Null\",\"FleetIDDescription\":\"YG67OUM\",\"ParentCustomerId\":649"
                + "4,\"PINIndicator\":\"Y, N\",\"ProductGroupName\":\"Fees\",\"PurchasedInCountryCo"
                + "de\":\"GB\",\"Quantity\":43.28,\"RebateRate\":0.0022,\"ReceiptNumber\":6803,\"Re"
                + "fundFlag\":\"Y\",\"SiteGroupId\":202,\"SiteGroupName\":\"CZ 9100 ECONOMY NETWORK"
                + "\",\"Latitude\":53.83606,\"Longitude\":-1.61854,\"DelCoExchangeRate\":0.851858,"
                + "\"EuroRebateAmount\":-0.258259,\"NetEuroAmount\":56.01,\"EuroVATAmount\":11.2,"
                + "\"ParentCustomerName\":\"FUEL CARD SERVICES LTD\",\"IsInvoiced\":false,\"Transac"
                + "tionCurrencyCode\":\"GBP\",\"CreditDebitCode\":\"D or C\",\"TransactionDate\":"
                + "\"2021-08-01\",\"TransactionTime\":\"0001-01-01T12:16:58Z\",\"TransactionItemId"
                + "\":\"H305908971030\",\"TrnIdentifier\":\"H305908971030\",\"Type\":\"SALE\",\"Tra"
                + "nsactionLine\":1,\"TransactionType\":\"Purchase\",\"UTCOffset\":\"Europe/London"
                + "\",\"VATCategory\":\"United Kingdom Standard VAT Rate\",\"VATRate\":0.2,\"Vehicl"
                + "eRegistration\":\"YG67OUM\",\"IsCancelled\":\"Y\",\"ColCoGrossAmount\":57.25,\"C"
                + "olCoNetAmount\":47.71,\"ColCoVATAmount\":9.54,\"OriginalCurrencySymbol\":\"$\","
                + "\"OriginalCurrencyCode\":\"$\",\"OriginalVATAmount\":0,\"EmbossText\":\"PARKLANE"
                + " PROPERTIES LTD\",\"OriginalExchangeRate\":0,\"OriginalTransactionItemInvoiceDat"
                + "e\":\"2022-02-02\",\"FeeTypeId\":1,\"LineItemDescription\":true,\"FeeRuleDescrip"
                + "tion\":\"Simple Fee\",\"Frequency\":1,\"FeeRuleId\":1,\"SystemEntryDate\":\"2021"
                + "-08-28\",\"SystemEntryTime\":\"0001-01-01T20:21:08Z\",\"IsManual\":\"Y\",\"Origi"
                + "nalTransactionItemId\":\"Y\",\"OriginalTransactionItemInvoiceNumber\":6750802,"
                + "\"OriginalTransactionItemInvoiceId\":234,\"PayerShortName\":\"FUEL CARD SERVICES"
                + " LTD\",\"ReverseCharge\":\"Y\",\"OriginalGrossAmount\":57.25,\"OriginalNetAmount"
                + "\":57.25,\"UnitOfMeasure\":\"L\",\"RoadType\":\"National Road\",\"CustomerCountr"
                + "yIsoCode\":\"DE\",\"EVOperator\":\"Shell Recharge\",\"EVSerialId\":\"GBALLEGO000"
                + "2452\",\"EVChargePointSerial\":\"GBALLEGO0002452\",\"EVChargePointConnectorType"
                + "\":5,\"EVChargePointConnectorTypeDescription\":\"DC 50 kW\",\"EVChargeDuration"
                + "\":\"PT3205S\",\"EVChargeStartDate\":\"2021-08-01\",\"EVChargeStartTime\":\"0001"
                + "-01-01T20:08:01Z\",\"EVChargeEndDate\":\"2022-08-01\",\"EVChargeEndTime\":\"0001"
                + "-01-01T20:08:01Z\",\"HostingCollectingCompanyNumber\":0,\"TransactionId\":0,\"Fu"
                + "elOnly\":true}],\"Page\":3,\"PageSize\":30,\"TotalPages\":5}",
                TestHelper.convertStreamToString(httpResponse.getResponse().getRawBody()), 
                false, true, false));
    }

}
